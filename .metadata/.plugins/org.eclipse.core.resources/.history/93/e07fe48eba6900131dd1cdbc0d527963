from django.shortcuts import render
from MedQuipSite.forms import RegisterForm,LoginForm
from Customers.models import Customer
import hashlib
import Products.view_data as view_data
from django.http import HttpResponse, Http404, HttpResponseRedirect

# Create your views here.

def my_account(request):
    
    
    return render(request)

def register(request):
    if request.method == 'POST':
        loginForm = LoginForm()
        registerForm = RegisterForm(request.POST)
        valid = True
        if registerForm.is_valid():
            if registerForm['password'] != registerForm['confirm_password']:
                registerForm['confirm_password'].errors.append("Passwords do not match")
                valid = False
            if len(registerForm['password']) < 8:
                registerForm['password'].errors.append("Password must be atleast 8 characters")
                valid = False
            
        
        if not valid:
            return render(request,'register.html',dict(view_data.get_2_plus_column_base_data(request)+{'login':loginForm,'register':registerForm}))
        else:
            # take form data and add new customer
            
            return render(request,'register_thanks.html',view_data.get_2_plus_column_base_data(request))
        
    else: #user loaded register view without having submitted the form
        loginForm = LoginForm()
        registerForm = RegisterForm()
        return render(request,'register.html',dict(view_data.get_2_plus_column_base_data(request)+{'login':loginForm,'register':registerForm}))

def login(request):
    form = LoginForm(request.GET)
    if form.is_valid():
        customer = Customer.objects.filter(email=request.GET['email']).get()
        input_password = hashlib.sha224(request.GET['password']).hexdigest()
        if(not customer):
            form.errors.append("Email Address not found")
        else:
            if customer.password == input_password:
                request.session['user'] = customer.email
                return HttpResponseRedirect(request,'')
            else:
                form.errors.append("Email / Password combination not found")
            
    registerForm = RegisterForm()
    return render(request,'register.html',dict(view_data.get_2_plus_column_base_data(request)+{'login':form,'register':registerForm}))
    

def orders(request):
    
    
    return render(request,'register.html')

def order(request,order_id):
    
    
    return render(request,'register.html')
