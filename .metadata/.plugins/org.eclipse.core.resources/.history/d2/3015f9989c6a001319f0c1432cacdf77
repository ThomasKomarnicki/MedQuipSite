from django.shortcuts import render
from MedQuipSite.forms import RegisterForm,LoginForm,RecoverForm
from Customers.models import Customer
import hashlib
import Products.view_data as view_data
from django.http import HttpResponse, HttpResponseRedirect

def register(request):
    if request.method == 'POST':
        print "SUBMITTED REGISTER FORM"
        loginForm = LoginForm()
        registerForm = RegisterForm(request.POST)
        if registerForm.is_valid():
            data = registerForm.cleaned_data
            customer = Customer(first=data['first_name'],last=data['last_name'],email=data['email'],password=hashlib.sha224(data['password']).hexdigest())
            customer.save()
            request.session['user'] = customer.email
            print "ABOUT TO REDIRECT TO /THANKS"
            return HttpResponseRedirect('/Thanks')
        else:
            return render(request,'register.html',dict(view_data.get_2_plus_column_base_data(request).items()+{'login':loginForm,'register':registerForm}.items()))
        
    else: #user loaded register view without having submitted the form
        loginForm = LoginForm()
        registerForm = RegisterForm()
        return render(request,'register.html',dict(view_data.get_2_plus_column_base_data(request).items()+{'login':loginForm,'register':registerForm}.items()))

def login(request):
    form = LoginForm(request.GET)
    if form.is_valid():
        request.session['user'] = form.cleaned_data['email']
        return HttpResponseRedirect('/')
    else:   
        registerForm = RegisterForm()
        return render(request,'register.html',dict(view_data.get_2_plus_column_base_data(request).items()+{'login':form,'register':registerForm}.items()))

def register_thanks(request):
    
    return render(request,'register_thanks.html',view_data.get_2_plus_column_base_data(request))

def sign_out(request):
    if('user' in request.session):
        del request.session['user']
        
    return render(request,'signed_out.html',view_data.get_2_plus_column_base_data(request))

def recover_password(request):
    if request.method == 'POST':
        recoverForm = RecoverForm(request.POST)
        if recoverForm.is_valid():
            
    
    else:
        recoverForm = RecoverForm()
        return render(request,'recover_password.html',view_data.get_2_plus_column_base_data(request).items() + {'form':recoverForm}.items())
    

def my_account(request):
    
    
    return render(request,'')

def orders(request):
    
    
    return render(request,'')

def order(request,order_id):
    
    
    return render(request,'')
